"use strict";
angular
        .module('chat', [
    
            //module for state routing.
            'ui.router'

        ]);
(function () {
    'use strict';

    angular
        .module('chat')
        .service('chatService', chatService)

    chatService.$inject = ['$q', '$http', 'constantService']

    /** @ngInject */
    function chatService($q, $http, constantService) {

        var vm = this;

        vm.getChat = function () {
            var deferred = $q.defer();
            $http.get(constantService.getUrlChat(), {
                cache: false,
            })
                .success(function (data) {
                    deferred.resolve({error: false, chats: data});
                })
                .error(function (err) {
                    deferred.resolve({error: true, e: err});
                });
            return deferred.promise;
        };

        return {
            getChat: vm.getChat
        };

    }

}());
(function () {
    'use strict';

    angular
        .module('chat')
        .controller('chatController', loginController)

    loginController.$injejct = ['$state', 'chatService', 'constantServiceString', '$rootScope', 'socketio'];

    /** @ngInject */
    function loginController($state, chatService, constantServiceString, $rootScope, socketio) {
        var vm = this;
        vm.chats = [];

        vm.getChat = function() {
            chatService.getChat().then(function(data){
                console.log(data);
                vm.chats = data.chats;
            });
        };

        vm.chat = function(){
            socketio.on('pong', function(){
                console.log('PONG');
            });
            socketio.emit('ping')
        }
     
        vm.getChat();
        vm.chat();
    }

} ());
(function () {
    "use strict";

    angular
        .module('chat')
        .factory('utilitiesService', utilitiesService);

    utilitiesService.$inject = [];

    function utilitiesService() {

        var vm = this;

        return {

        }

    }
})();
(function () {
    'use strict';

    angular
        .module('chat')
        .factory('socketio', socketio);

    socketio.inject = ['$rootScope', 'constantService'];
    
    function socketio($rootScope, constantService) {

        var vm = this;
        vm.socket = io.connect(constantService.server);

        vm.on = function (eventName, callback) {
            vm.socket.on(eventName, function () {
                var args = arguments;
                $rootScope.$apply(function () {
                    callback.apply(vm.socket, args);
                });
            });
        }
        vm.emit = function (eventName, data, callback) {
            vm.socket.emit(eventName, data, function () {
                var args = arguments;
                $rootScope.$apply(function () {
                    if (callback) {
                        callback.apply(vm.socket, args);
                    }
                });
            });
        }
        return {
            on: vm.on,
            emit: vm.emit
        }
    }

})();
(function () {
    "use strict";

    angular
        .module('chat')
        .factory('constantServiceString', constantServiceString);

    constantServiceString.$inject = ['$q', '$http'];

    function constantServiceString($q, $http) {

        var vm = this;

        vm.getStrings = getStrings;

        function getStrings() {
            var deferred = $q.defer();
            $http.get('../../strings_spanish.json', {
                cache: true
            }).success(function (data) {
                deferred.resolve(data);
            });
            return deferred.promise;
        }

        return {
            getStrings: vm.getStrings
        }
    }
})();
(function () {
    "use strict";

    angular
        .module('chat')
        .factory('constantService', constantService);

    constantService.$inject = ['$rootScope'];

    function constantService($rootScope) {

        var vm = this;
        //DEVELOP
        vm.endponint = 'http://localhost:3000';

        //PRODUCCION
        //vm.endponint = 'https://pragmachat.herokuapp.com';

        vm.endponint = '';

        vm.getUrlChat = function () {
            return vm.endponint + '/api/getchats';
        };

        return {
            server: vm.endponint,
            getUrlChat: vm.getUrlChat
        }

    }
})();

"use strict";

angular
    .module('chat')
    .config(routes);

routes.$inject = ['$stateProvider', '$urlRouterProvider', '$httpProvider'];

function routes($stateProvider, $urlRouterProvider, $httpProvider) {

    $stateProvider
        .state('chat', {
            url: '/',
            templateUrl: 'app/features/chat/chat.view.html',
            controller: 'chatController as chatCtrl'
        })

    $urlRouterProvider.otherwise('/')
}
"use strict";

angular
    .module('chat')
    .run(run);

run.$inject = ['$rootScope', '$window'];

function run($rootScope, $window) {

}